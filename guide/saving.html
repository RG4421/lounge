<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <title>Lounge</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" type="text/css">
    <link rel="stylesheet" href="../api/css/bootstrap.css">
    <link rel="stylesheet" href="../api/css/cayman.css">
    <link rel="stylesheet" href="../api/css/prism.css">
</head>
<body>
<section class="page-header">
    <h1 class="project-name">Lounge</h1>

    <h2 class="project-tagline">Simple Mongoose-inspired ODM for Couchbase</h2>
    <a href="http://bojand.github.io/lounge" target="_blank" class="btn">Home</a>
    <a href="https://github.com/bojand/lounge" target="_blank" class="btn">View on GitHub</a>
    <a href="https://npmjs.com/package/lounge" target="_blank" class="btn">View on npm</a>
</section>
<section data-spy="scroll" data-target=".scrollspy" class="main-content">
    <div class="row">
        <div class="col-md-3 col-xs-3 bs-docs-sidebar">
            <ul id="sidebar" class="nav nav-stacked fixed">
                <li><a href="index.html">Setup</a></li>
                <li><a href="model.html">Modelling</a></li>
                <li><a href="mw.html">Middleware</a></li>
                <li><a href="extend.html">Schema Extension</a></li>
                <li><a href="embedded.html">Embedded</a></li>
                <li><a href="saving.html">Saving Documents</a></li>
                <li><a href="getting.html">Retrieving Documents</a></li>
                <li><a href="removing.html">Removing Documents</a></li>
                <li><a href="populate.html">Population</a></li>
                <li><a href="indexes.html">Indexes</a></li>
                <li><a href="events.html">Events</a></li>
            </ul>
        </div>
        <div class="col-md-9">
            <section id="Main" class="readme">
<h3 id="saving-documents-a-id-saving-a-">Saving Documents <a id="saving"></a></h3>
<p>Saving documents is done using <code>save</code> function that every model instance has. This will execute all pre 
&#39;save&#39; middleware and then perform Couchbase <code>upsert</code> operation on any subdocuments and the actual document. It will also
perform lookup document updates and finally execute any post hook middleware.</p>
<p>From our example code above:</p>
<pre><code class="lang-js">user.save(function(err, savedDoc) {
  if(err) console.log(err);
});
</code></pre>
<p>All documents and subdocuments would be upserted into the database.</p>
<p><strong>Model.save(data, options, fn)</strong></p>
<p><code>data</code> - any data to be set into the model before saving.</p>
<p><strong>options</strong></p>
<p>All options not present here are first looked up from schema options, and then from config options.</p>
<ul>
<li><code>storeFullReferenceId</code> - whether to save embedded document property values as full document keys or just the base value</li>
<li><code>storeFullKey</code> - whether to save the internal document key property as fully expanded value or as the simple value</li>
<li><code>refIndexKeyPrefix</code> - lookup index document key prefix.</li>
<li><code>waitForIndex</code> - whether we want to wait for indexing to finish before returning. default is false.</li>
<li><code>virtuals</code> - whether we want to save virtuals. default is <code>false</code>.</li>
<li><code>minimize</code> - to &quot;minimize&quot; the document by removing any empty properties. Default: <code>true</code></li>
<li><code>expiry</code> - couchbase upsert option</li>
<li><code>persist_to</code> - couchbase persist_to option</li>
<li><code>replicate_to</code> - couchbase option</li>
</ul>
<h3 id="getting-documents-a-id-getting-a-">Getting Documents <a id="getting"></a></h3>
<p>All models created come with a static function <code>findById</code> that can be used to look up a single or multiple keys and 
retrieve documents from the database. If key does not exist and document is not found we <strong>do not</strong> return an error
but also no model is generated. This is different than present couchbase module behaviour.</p>
<pre><code class="lang-js">User.findById(&#39;user123&#39;, function(err, doc) {
  if(err) console.log(err); // there was an error looking up the key
  else if(!doc) console.log(&#39;no document found&#39;);
  else console.log(doc); // doc is instance of User and will print it out 
});
</code></pre>
<p>We can get multiple keys using an array as the first parameter. In this case, the callback invoked is passed 3 arguments
in form <code>(err, documents, misses)</code>. </p>
<pre><code class="lang-js">User.findById([&#39;user123&#39;, &#39;user456&#39;], function(err, docs, misses) {
  if(err) console.log(err); // there was an error looking up the key
  console.dir(docs);        // array of Users found
  console.dir(misses);      // array if keys not found.
});
</code></pre>
<p>When <code>findById</code> is invoked using a single string argument the result returned is a single model instance. When an array
is passed in we return the results as described above. To force &quot;array&quot; type of returns in ALL cases, set the Lounge
config option <code>alwaysReturnArrays</code> to <code>true</code>. Default is <code>false</code>.</p>
</section>
</div>
</div>
</section>
<script src="../api/js/jquery.min.js"></script>
<script src="../api/js/bootstrap.min.js"></script>
<script src="../api/js/affix.js"></script>
<script src="../api/js/dropdown.js"></script>
<script src="../api/js/scrollspy.js"></script>
<script src="../api/js/prism.js"></script>
<script src="../api/js/prism-bash.js"></script>
<script>
    $(document).ready(function () {
        $('body').scrollspy({
            target: ".bs-docs-sidebar",
            offset: 40
        });
        $('#sidebar').affix({
            offset: {
                bottom: 60,
                top: 60
            }
        })
    });
</script>
</body>
</html>