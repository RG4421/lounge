<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <title>Lounge</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" type="text/css">
    <link rel="stylesheet" href="../api/css/bootstrap.css">
    <link rel="stylesheet" href="../api/css/cayman.css">
    <link rel="stylesheet" href="../api/css/prism.css">
</head>
<body>
<section class="page-header">
    <h1 class="project-name">Lounge</h1>

    <h2 class="project-tagline">Simple Mongoose-inspired ODM for Couchbase</h2><a
        href="https://github.com/bojand/lounge" target="_blank" class="btn">View on GitHub</a><a
        href="https://npmjs.com/package/lounge" target="_blank" class="btn">View on npm</a>
</section>
<section data-spy="scroll" data-target=".scrollspy" class="main-content">
    <div class="row">
        <div class="col-md-3 col-xs-3 bs-docs-sidebar">
            <ul id="sidebar" class="nav nav-stacked fixed">
                <li><a href="http://bojand.github.io/lounge">Home</a></li>
                <li><a href="index.html">Setup</a></li>
                <li><a href="model.html">Modelling</a></li>
                <li><a href="mw.html">Middleware</a></li>
                <li><a href="extend.html">Schema Extension</a></li>
                <li><a href="embedded.html">Embedded</a></li>
                <li><a href="saving.html">Saving Documents</a></li>
                <li><a href="getting.html">Retrieving Documents</a></li>
                <li><a href="removing.html">Removing Documents</a></li>
                <li><a href="populate.html">Population</a></li>
                <li><a href="indexes.html">Indexes</a></li>
                <li><a href="events.html">Events</a></li>
            </ul>
        </div>
        <div class="col-md-9">
            <section id="Main" class="readme">
<h3 id="indexes-a-id-indexes-a-">Indexes <a id="indexes"></a></h3>
<p>Lounge provides Indexing mechanism using <a href="http://docs.couchbase.com/developer/dev-guide-3.0/lookups.html">reference lookup documents</a>.
This allows us to set up simple one to one lookups for easier document retrieval where we do not need to do create view
indexes. Specifying an index property is done at schema level:</p>
<pre><code class="lang-js">var userSchema = lounge.schema({
  name: String,
  email: {type: String, index: true}
});
</code></pre>
<p>Here we wish <code>User</code> models to have their own <code>id</code> as document key, but we want to be able to look up documents via email
as well as that is also unique property for users. Lounge will automatically manage (remove and upsert) lookup documents,
as user is <code>saved</code> or <code>removed</code>. </p>
<pre><code class="lang-js">var user = new User({
  name: &#39;Joe Smith&#39;,
  email: &#39;joe@gmail.com&#39;
});

user.save();
</code></pre>
<p>This will create the a lookup document similar to:</p>
<pre><code>{ key: &#39;2ba8a471-063b-420a-aa83-31debe58f46f&#39; }
</code></pre><p>with document key <code>&#39;$_ref_by_email_joe@gmail.com&#39;</code>. We can manipulate this behaviour using schema options.</p>
<pre><code class="lang-js">var userSchema = lounge.schema({
  name: String,
  email: {type: String, index: true}
}, {
  keyPrefix: &#39;user::&#39;,
  delimiter: &#39;::&#39;
});
</code></pre>
<p>Saving a document defined with this schema will save user document with key <code>&#39;user::5c4bfd6d-9c80-452b-be3a-3e528e4f53f5&#39;</code>
and will save a lookup document with key <code>&#39;&#39;user::$_ref_by_email::joe@gmail.com&#39;</code>. Setting <code>refIndexKeyPrefix</code> can add
additional customization.</p>
<pre><code class="lang-js">{
  keyPrefix: &#39;user::&#39;,
  delimiter: &#39;::&#39;,
  refIndexKeyPrefix: &#39;lookup_by_&#39;
}
</code></pre>
<p>This will result in lookup document key <code>user::lookup_by_email::joe@gmail.com</code>.</p>
<p>Indexes can also be arrays:</p>
<pre><code class="lang-js">var userSchema = lounge.schema({
  name: String
  usernames: [{type: String, index: true}]
});
</code></pre>
<p>A lookup document will be generated for each value in the array. Index lookup properties have to be of type <code>String</code> or
<code>Number</code>.</p>
<p>Index lookup documents are automatically managed by lounge when documents are saved and removed using <code>save()</code> and
<code>remove()</code> functions. You can also manually kick of this process by calling <code>index()</code> function on any model instance.</p>
<h4 id="index-queries-a-id-queries-a-">Index queries <a id="queries"></a></h4>
<p>Any indexed property the Model will automatically get a <code>findBy*</code> static function for easier lookup. 
For example code above:</p>
<pre><code class="lang-js">var User = lounge.model(&#39;User&#39;, userSchema);

User.findByEmail(&#39;joe@gmail.com&#39;, function(err, doc) {
  if(err) console.log(err);
  else console.log(doc);
});
</code></pre>
<p>We automatically singularize and camelize property key to derive the index name. So <code>usernames</code> becomes <code>findByUsername</code>.
We can specify the index &quot;name&quot; by passing along the <code>indexName</code> property. For example:</p>
<pre><code class="lang-js">var userSchema = lounge.schema({
  name: String
  usernames: [{type: String, index: true, indexName: &#39;UN&#39;}]
});

var User = lounge.model(&#39;User&#39;, userSchema);

User.findByUN(&#39;user1&#39;, function(err, doc) {
  if(err) console.log(err);
  else console.log(doc);
});
</code></pre>
</section>
</div>
</div>
</section>
<script src="../api/js/jquery.min.js"></script>
<script src="../api/js/bootstrap.min.js"></script>
<script src="../api/js/affix.js"></script>
<script src="../api/js/dropdown.js"></script>
<script src="../api/js/scrollspy.js"></script>
<script src="../api/js/prism.js"></script>
<script src="../api/js/prism-bash.js"></script>
<script>
    $(document).ready(function () {
        $('body').scrollspy({
            target: ".bs-docs-sidebar",
            offset: 40
        });
        $('#sidebar').affix({
            offset: {
                bottom: 60,
                top: 60
            }
        })
    });
</script>
</body>
</html>