<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Lounge</title>
    
    <meta name="description" content="Simple Mongoose-inspired ODM for Couchbase" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"Lounge","meta":{"title":"Lounge","description":"Simple Mongoose-inspired ODM for Couchbase","keyword":""},"linenums":true};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">Lounge</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">

    
        <li class="item" data-name="">
            <span class="title">
                <a href="-_.html"></a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="#cas"><a href="global.html#cas">cas</a></li>
            
                <li data-name="#config"><a href="global.html#config">config</a></li>
            
                <li data-name="#db"><a href="global.html#db">db</a></li>
            
                <li data-name="#modelName"><a href="global.html#modelName">modelName</a></li>
            
                <li data-name="#schema"><a href="global.html#schema">schema</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="#_broadcast"><a href="global.html#_broadcast">_broadcast</a></li>
            
                <li data-name="#clear"><a href="global.html#clear">clear</a></li>
            
                <li data-name="#clearErrors"><a href="global.html#clearErrors">clearErrors</a></li>
            
                <li data-name="#getCAS"><a href="global.html#getCAS">getCAS</a></li>
            
                <li data-name="#getDocumentKeyKey"><a href="global.html#getDocumentKeyKey">getDocumentKeyKey</a></li>
            
                <li data-name="#getDocumentKeyValue"><a href="global.html#getDocumentKeyValue">getDocumentKeyValue</a></li>
            
                <li data-name="#getErrors"><a href="global.html#getErrors">getErrors</a></li>
            
                <li data-name="#hasErrors"><a href="global.html#hasErrors">hasErrors</a></li>
            
                <li data-name="#index"><a href="global.html#index">index</a></li>
            
                <li data-name="#inspect"><a href="global.html#inspect">inspect</a></li>
            
                <li data-name="#remove"><a href="global.html#remove">remove</a></li>
            
                <li data-name="#removeIndexes"><a href="global.html#removeIndexes">removeIndexes</a></li>
            
                <li data-name="#save"><a href="global.html#save">save</a></li>
            
                <li data-name="#set"><a href="global.html#set">set</a></li>
            
                <li data-name="#toJSON"><a href="global.html#toJSON">toJSON</a></li>
            
                <li data-name="#toObject"><a href="global.html#toObject">toObject</a></li>
            
                <li data-name="#toString"><a href="global.html#toString">toString</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="BaseObject">
            <span class="title">
                <a href="BaseObject.html">BaseObject</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="BaseObject#schema"><a href="BaseObject.html#schema">schema</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="BaseObject#clear"><a href="BaseObject.html#clear">clear</a></li>
            
                <li data-name="BaseObject#clearErrors"><a href="BaseObject.html#clearErrors">clearErrors</a></li>
            
                <li data-name="BaseObject#getErrors"><a href="BaseObject.html#getErrors">getErrors</a></li>
            
                <li data-name="BaseObject#hasErrors"><a href="BaseObject.html#hasErrors">hasErrors</a></li>
            
                <li data-name="BaseObject#inspect"><a href="BaseObject.html#inspect">inspect</a></li>
            
                <li data-name="BaseObject#set"><a href="BaseObject.html#set">set</a></li>
            
                <li data-name="BaseObject#toJSON"><a href="BaseObject.html#toJSON">toJSON</a></li>
            
                <li data-name="BaseObject#toObject"><a href="BaseObject.html#toObject">toObject</a></li>
            
                <li data-name="BaseObject#toString"><a href="BaseObject.html#toString">toString</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="CouchbaseDocument">
            <span class="title">
                <a href="CouchbaseDocument.html">CouchbaseDocument</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="CouchbaseDocument#cas"><a href="CouchbaseDocument.html#cas">cas</a></li>
            
                <li data-name="CouchbaseDocument#config"><a href="CouchbaseDocument.html#config">config</a></li>
            
                <li data-name="CouchbaseDocument#db"><a href="CouchbaseDocument.html#db">db</a></li>
            
                <li data-name="CouchbaseDocument#modelName"><a href="CouchbaseDocument.html#modelName">modelName</a></li>
            
                <li data-name="CouchbaseDocument#schema"><a href="CouchbaseDocument.html#schema">schema</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="CouchbaseDocument.findById"><a href="CouchbaseDocument.html#.findById">findById</a></li>
            
                <li data-name="CouchbaseDocument.remove"><a href="CouchbaseDocument.html#.remove">remove</a></li>
            
                <li data-name="CouchbaseDocument#_broadcast"><a href="CouchbaseDocument.html#_broadcast">_broadcast</a></li>
            
                <li data-name="CouchbaseDocument#clear"><a href="CouchbaseDocument.html#clear">clear</a></li>
            
                <li data-name="CouchbaseDocument#clearErrors"><a href="CouchbaseDocument.html#clearErrors">clearErrors</a></li>
            
                <li data-name="CouchbaseDocument#getCAS"><a href="CouchbaseDocument.html#getCAS">getCAS</a></li>
            
                <li data-name="CouchbaseDocument#getDocumentKeyKey"><a href="CouchbaseDocument.html#getDocumentKeyKey">getDocumentKeyKey</a></li>
            
                <li data-name="CouchbaseDocument#getDocumentKeyValue"><a href="CouchbaseDocument.html#getDocumentKeyValue">getDocumentKeyValue</a></li>
            
                <li data-name="CouchbaseDocument#getErrors"><a href="CouchbaseDocument.html#getErrors">getErrors</a></li>
            
                <li data-name="CouchbaseDocument#hasErrors"><a href="CouchbaseDocument.html#hasErrors">hasErrors</a></li>
            
                <li data-name="CouchbaseDocument#index"><a href="CouchbaseDocument.html#index">index</a></li>
            
                <li data-name="CouchbaseDocument#inspect"><a href="CouchbaseDocument.html#inspect">inspect</a></li>
            
                <li data-name="CouchbaseDocument#remove"><a href="CouchbaseDocument.html#remove">remove</a></li>
            
                <li data-name="CouchbaseDocument#removeIndexes"><a href="CouchbaseDocument.html#removeIndexes">removeIndexes</a></li>
            
                <li data-name="CouchbaseDocument#save"><a href="CouchbaseDocument.html#save">save</a></li>
            
                <li data-name="CouchbaseDocument#set"><a href="CouchbaseDocument.html#set">set</a></li>
            
                <li data-name="CouchbaseDocument#toJSON"><a href="CouchbaseDocument.html#toJSON">toJSON</a></li>
            
                <li data-name="CouchbaseDocument#toObject"><a href="CouchbaseDocument.html#toObject">toObject</a></li>
            
                <li data-name="CouchbaseDocument#toString"><a href="CouchbaseDocument.html#toString">toString</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Document">
            <span class="title">
                <a href="Document.html">Document</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Document#modelName"><a href="Document.html#modelName">modelName</a></li>
            
                <li data-name="Document#schema"><a href="Document.html#schema">schema</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Document.getDocumentKeyValue"><a href="Document.html#.getDocumentKeyValue">getDocumentKeyValue</a></li>
            
                <li data-name="Document#clear"><a href="Document.html#clear">clear</a></li>
            
                <li data-name="Document#clearErrors"><a href="Document.html#clearErrors">clearErrors</a></li>
            
                <li data-name="Document#getDocumentKeyKey"><a href="Document.html#getDocumentKeyKey">getDocumentKeyKey</a></li>
            
                <li data-name="Document#getDocumentKeyValue"><a href="Document.html#getDocumentKeyValue">getDocumentKeyValue</a></li>
            
                <li data-name="Document#getErrors"><a href="Document.html#getErrors">getErrors</a></li>
            
                <li data-name="Document#hasErrors"><a href="Document.html#hasErrors">hasErrors</a></li>
            
                <li data-name="Document#inspect"><a href="Document.html#inspect">inspect</a></li>
            
                <li data-name="Document#set"><a href="Document.html#set">set</a></li>
            
                <li data-name="Document#toJSON"><a href="Document.html#toJSON">toJSON</a></li>
            
                <li data-name="Document#toObject"><a href="Document.html#toObject">toObject</a></li>
            
                <li data-name="Document#toString"><a href="Document.html#toString">toString</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Driver">
            <span class="title">
                <a href="Driver.html">Driver</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Driver.wrap"><a href="Driver.html#.wrap">wrap</a></li>
            
                <li data-name="Driver#get"><a href="Driver.html#get">get</a></li>
            
                <li data-name="Driver#remove"><a href="Driver.html#remove">remove</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Lounge">
            <span class="title">
                <a href="Lounge.html">Lounge</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Lounge#CouchbaseDocument"><a href="Lounge.html#CouchbaseDocument">CouchbaseDocument</a></li>
            
                <li data-name="Lounge#Document"><a href="Lounge.html#Document">Document</a></li>
            
                <li data-name="Lounge#Lounge"><a href="Lounge.html#Lounge">Lounge</a></li>
            
                <li data-name="Lounge#Model"><a href="Lounge.html#Model">Model</a></li>
            
                <li data-name="Lounge#Schema"><a href="Lounge.html#Schema">Schema</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Lounge#connect"><a href="Lounge.html#connect">connect</a></li>
            
                <li data-name="Lounge#disconnect"><a href="Lounge.html#disconnect">disconnect</a></li>
            
                <li data-name="Lounge#getModel"><a href="Lounge.html#getModel">getModel</a></li>
            
                <li data-name="Lounge#getOption"><a href="Lounge.html#getOption">getOption</a></li>
            
                <li data-name="Lounge#model"><a href="Lounge.html#model">model</a></li>
            
                <li data-name="Lounge#modelNames"><a href="Lounge.html#modelNames">modelNames</a></li>
            
                <li data-name="Lounge#schema"><a href="Lounge.html#schema">schema</a></li>
            
                <li data-name="Lounge#setOption"><a href="Lounge.html#setOption">setOption</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="MemoDriver">
            <span class="title">
                <a href="MemoDriver.html">MemoDriver</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="MemoDriver#get"><a href="MemoDriver.html#get">get</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="MemoDriver#clear"><a href="MemoDriver.html#clear">clear</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="ModelInstance">
            <span class="title">
                <a href="ModelInstance.html">ModelInstance</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="ModelInstance.config"><a href="ModelInstance.html#.config">config</a></li>
            
                <li data-name="ModelInstance.db"><a href="ModelInstance.html#.db">db</a></li>
            
                <li data-name="ModelInstance.modelName"><a href="ModelInstance.html#.modelName">modelName</a></li>
            
                <li data-name="ModelInstance.schema"><a href="ModelInstance.html#.schema">schema</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="ObjectArray">
            <span class="title">
                <a href="ObjectArray.html">ObjectArray</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Schema">
            <span class="title">
                <a href="Schema.html">Schema</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Schema#add"><a href="Schema.html#add">add</a></li>
            
                <li data-name="Schema#extend"><a href="Schema.html#extend">extend</a></li>
            
                <li data-name="Schema#get"><a href="Schema.html#get">get</a></li>
            
                <li data-name="Schema#getDocumentKeyValue"><a href="Schema.html#getDocumentKeyValue">getDocumentKeyValue</a></li>
            
                <li data-name="Schema#getRefKey"><a href="Schema.html#getRefKey">getRefKey</a></li>
            
                <li data-name="Schema#hasRefPath"><a href="Schema.html#hasRefPath">hasRefPath</a></li>
            
                <li data-name="Schema#method"><a href="Schema.html#method">method</a></li>
            
                <li data-name="Schema#post"><a href="Schema.html#post">post</a></li>
            
                <li data-name="Schema#pre"><a href="Schema.html#pre">pre</a></li>
            
                <li data-name="Schema#set"><a href="Schema.html#set">set</a></li>
            
                <li data-name="Schema#static"><a href="Schema.html#static">static</a></li>
            
                <li data-name="Schema#virtual"><a href="Schema.html#virtual">virtual</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="baseobject.js.html">Source: baseobject.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const _ = require('lodash');
const clone = require('clone');
const EventEmitter = require('events').EventEmitter;

import _privateKey from './privatekey';
import { getFunctionName } from './utils';
import { defineSetter, defineGetter, clearField } from './baseobject.utils';

const _reservedFields = ['super'];

export default class BaseObject extends EventEmitter {
  /**
   * @classdesc Base representation for all created Document instances.
   * Represents just the document data and generic properties and functions.
   * Also used for "object" abstraction / representation of sub documents that are not actual Models / Documents.
   * Clients should never have to call this directly. Extends &lt;code>EventEmitter&lt;/code>.
   *
   * @description Clients do not need to create &lt;code>BaseObject&lt;/code> instances manually.
   * @class
   * @augments EventEmitter
   * @param {Object} values - the object data
   * @param {Object} options - creation options
   * @param {Boolean} options.clone - Whether to deep clone the incoming data. Default: &lt;code>false&lt;/code>.
   *                                  Make sure you wish to do this as it has performance implications. This is
   *                                  useful if you are creating multiple instances from same base data and then
   *                                  wish to modify each instance.
   * @param {Schema} schema - schema instance
   * @returns {BaseObject}
   */
  constructor(values, options, schema) {
    super();

    // Object used to store internals.
    const _private = this[_privateKey] = {};

    // Object with getters and setters bound.
    _private._getset = this;

    // Public version of ourselves.
    // Overwritten with proxy if available.
    _private._this = this;

    // Object used to store raw values.
    _private._obj = {};

    _private.schema = schema;

    // Errors, retrieved with getErrors().
    _private._errors = [];

    // Reserved keys for storing internal properties accessible from outside.
    _private._reservedFields = {};

    // Define getters/typecasts based off of schema.
    _.each(schema.descriptor, (properties, index) => {
      // Use getter / typecast to intercept and re-route, transform, etc.
      defineGetter.call(_private._getset, index, properties);
      defineSetter.call(_private._getset, index, properties);
    });

    // Proxy used as interface to object allows to intercept all access.
    // Without Proxy we must register individual getter/typecasts to put any logic in place.
    // With Proxy, we still use the individual getter/typecasts, but also catch values that aren't in the schema.
    if (typeof Proxy !== 'undefined') {
      const proxy = this[_privateKey]._this = new Proxy(this, {
        // Ensure only public keys are shown
        ownKeys: (target) => {
          return Object.keys(this.toObject());
        },

        // Return keys to iterate
        enumerate: (target) => {
          return Object.keys(this[_privateKey]._this)[Symbol.iterator]();
        },

        // Check to see if key exists
        has: (target, key) => {
          return Boolean(_private._getset[key]);
        },

        // Ensure correct prototype is returned.
        getPrototypeOf: () => {
          return _private._getset;
        },

        // Ensure readOnly fields are not writeable.
        getOwnPropertyDescriptor: (target, key) => {
          return {
            value: proxy[key],
            writeable: !schema.descriptor[key] || schema.descriptor[key].readOnly !== true,
            enumerable: true,
            configurable: true
          };
        },

        // Intercept all get calls.
        get: (target, name, receiver) => {
          // First check to see if it's a reserved field.
          if (_reservedFields.includes(name)) {
            return this[_privateKey]._reservedFields[name];
          }

          // Support dot notation via lodash.
          if (this.schema.options.dotNotation &amp;&amp; name.indexOf('.') !== -1) {
            return _.get(this[_privateKey]._this, name);
          }

          // Use registered getter without hitting the proxy to avoid creating an infinite loop.
          return this[name];
        },

        // Intercept all set calls.
        set: (target, name, value, receiver) => {
          // Support dot notation via lodash.
          if (this.schema.options.dotNotation &amp;&amp; name.indexOf('.') !== -1) {
            return _.set(this[_privateKey]._this, name, value);
          }

          if (!schema.descriptor[name]) {
            if (this.schema.options.strict) {
              // Strict mode means we don't want to deal with anything not in the schema.
              // TODO: SetterError here.
              return;
            }

            // Add index to schema dynamically when value is set.
            // This is necessary for toObject to see the field.
            this._addToSchema(name, {
              type: 'any'
            });
          }

          // This hits the registered setter but bypasses the proxy to avoid an infinite loop.
          this[name] = value;
        },

        // Intercept all delete calls.
        deleteProperty: (target, property) => {
          this[property] = undefined;
          return true;
        }
      });
    }

    // Populate schema defaults into object.
    _.each(schema.descriptor, (properties, index) => {
      if (properties.default !== undefined) {
        // Temporarily ensure readOnly is turned off to prevent the set from failing.
        const readOnly = properties.readOnly;
        properties.readOnly = false;
        this[index] = _.isFunction(properties.default) ? properties.default.call(this) : properties.default;
        properties.readOnly = readOnly;
      }
    });

    // Populate runtime values as provided to this instance of object.
    if (_.isObject(values)) {
      let data = values;
      if (options.clone) {
        data = clone(values);
      }
      this.set(data);
    }

    // May return actual object instance or Proxy, depending on harmony support.
    return _private._this;
  }

  /**
   * Get the model schema instance
   * @api public
   * @returns {Schema}
   */
  get schema() {
    return this[_privateKey].schema;
  }

  // Add field to schema and initializes getter and setter for the field.
  _addToSchema(index, properties) {
    this.schema.add(index, properties);

    defineGetter.call(this[_privateKey]._getset, index, this.schema.descriptor[index]);
    defineSetter.call(this[_privateKey]._getset, index, this.schema.descriptor[index]);
  }

  /**
   * Sets data on the document based on the schema.
   * Accepts a key of property and value for the property, or object representing the data for document.
   *
   * @api public
   * @example
   * user.set('fistName', 'Joe');
   * user.set({ lastName: 'Smith' });
   */
  set(path, value) {
    if (_.isObject(path) &amp;&amp; !value) {
      value = path;
      for (const key in value) {
        if (value.hasOwnProperty(key)) {
          this[_privateKey]._this[key] = value[key];
        }
      }
    }
    else {
      this[_privateKey]._this[path] = value;
    }
  }

  _prepareToObjectOptions(options, json) {
    const defaultOptions = {
      transform: true,
      json: json,
      minimize: true
    };

    // When internally saving this document we always pass options,
    // bypassing the custom schema options.
    if (!(options &amp;&amp; getFunctionName(options.constructor) === 'Object') ||
      (options &amp;&amp; options._useSchemaOptions)) {
      if (json) {
        options = this.schema.options.toJSON ?
          clone(this.schema.options.toJSON) : {};
        options.json = true;
        options._useSchemaOptions = true;
      }
      else {
        options = this.schema.options.toObject ?
          clone(this.schema.options.toObject) : {};
        options.json = false;
        options._useSchemaOptions = true;
      }
    }

    for (const key in defaultOptions) {
      if (defaultOptions.hasOwnProperty(key) &amp;&amp; options[key] === undefined) {
        options[key] = defaultOptions[key];
      }
    }

    return options;
  }

  /**
   *
   * @param options
   * @param json
   * @returns {{}}
   * @private
   */
  _toObject(options, json) {
    options = this._prepareToObjectOptions(options, json);

    // remember the root transform function
    // to save it from being overwritten by sub-transform functions
    const originalTransform = options.transform;

    let ret = {};

    // Populate all properties in schema.
    _.each(this.schema.descriptor, (properties, index) => {
      // Do not write values to object that are marked as invisible.
      if (properties.invisible &amp;&amp; !properties.virtual) {
        return;
      }

      if (properties.virtual &amp;&amp; !options.virtuals) {
        return;
      }

      // Fetch value through the public interface.
      let value = this[_privateKey]._this[index];

      if (value === undefined &amp;&amp; options.minimize) {
        return;
      }

      // Clone objects so they can't be modified by reference.
      if (typeof value === 'object') {
        if (value._isBaseObject) {
          if (options &amp;&amp; options.json &amp;&amp; typeof value.toJSON === 'function') {
            value = value.toJSON(options);
          }
          else {
            value = value.toObject(options);
          }
        }
        else if (value._isObjectArray) {
          value = value.toArray();
        }
        else if (_.isArray(value)) {
          value = value.splice(0);
        }
        else if (_.isDate(value)) {
          // https://github.com/documentcloud/underscore/pull/863
          // _.clone doesn't work on Date object.
          const d = new Date(value.getTime());
          if (options.dateToISO === true) {
            ret[index] = d.toISOString();
          }
          else {
            ret[index] = new Date(value.getTime());
          }
        }
        else {
          value = _.clone(value);
        }

        // Don't write empty objects or arrays.
        if (!_.isDate(value) &amp;&amp; options.minimize &amp;&amp; !_.size(value)) {
          return;
        }
      }

      // Write to object.
      ret[index] = value;
    });

    let transform = options.transform;

    // In the case where a subdocument has its own transform function, we need to
    // check and see if the parent has a transform (options.transform) and if the
    // child schema has a transform (this.schema.options.toObject) In this case,
    // we need to adjust options.transform to be the child schema's transform and
    // not the parent schema's
    if (transform === true || (this.schema.options.toObject &amp;&amp; transform)) {
      const opts = options.json ? this.schema.options.toJSON : this.schema.options.toObject;

      if (opts) {
        transform = (typeof options.transform === 'function' ? options.transform : opts.transform);
      }
    }
    else {
      options.transform = originalTransform;
    }

    if (typeof transform === 'function') {
      const xformed = transform(this, ret, options);
      if (typeof xformed !== 'undefined') {
        ret = xformed;
      }
    }

    return ret;
  }

  /**
   * Converts this document into a plain javascript object.
   *
   * @api public
   * @param {Object} options
   * @param {Function} options.transform - a transform function to apply to the resulting document before returning.
   * @param {Boolean} options.virtuals - apply virtual getters. Default: &lt;code>false&lt;/code>
   * @param {Boolean} options.minimize - remove empty objects. Default: &lt;code>true&lt;/code>
   * @param {Boolean} options.dateToISO - convert dates to string in ISO format using &lt;code>Date.toISOString()&lt;/code>. Default: &lt;code>false&lt;/code>
   *
   * @return {Object} Plain javascript object representation of document.
   *
   * @example
   * var userSchema = lounge.schema({ name: String });
   * var User = lounge.model('User', userSchema);
   * var user = new User({name: 'Joe Smith'});
   * console.log(user); // automatically invokes toObject()
   *
   * @example &lt;caption>Example with transform option.&lt;/caption>
   * var xform = function (doc, ret, options) {
   *   ret.name = ret.name.toUpperCase();
   *   return ret;
   * };
   * console.dir(user.toObject({transform: xform}); // { name: 'JOE SMITH' }
   */
  toObject(options) {
    return this._toObject(options);
  }

  /**
   * Similar as &lt;code>toObject&lt;/code> but applied when &lt;code>JSON.stringify&lt;/code> is called
   *
   * @api public
   * @param {Object} options - Same options as &lt;code>toObject&lt;/code>.
   * @return {Object} Plain javascript object representation of document.
   */
  toJSON(options) {
    return this._toObject(options, true);
  }

  /**
   * Helper for &lt;code>console.log&lt;/code>. Just invokes default &lt;code>toObject&lt;/code>.
   * @api public
   */
  inspect() {
    return this.toObject({});
  }

  /**
   * Helper for &lt;code>console.log&lt;/code>. Alias for &lt;code>inspect&lt;/code>.
   * @api public
   */
  toString() {
    return this.inspect();
  }

  /**
   * Clear the document data.
   */
  clear() {
    _.each(this.schema.descriptor, (properties, index) => {
      clearField.call(this[_privateKey]._this, index, properties);
    });
  }

  /**
   * Gets the errors object.
   */
  getErrors() {
    return this[_privateKey]._errors;
  }

  /**
   * Clears all the errors.
   */
  clearErrors() {
    this[_privateKey]._errors.length = 0;
  }

  /**
   * Checks whether we have any errors.
   * @return {Boolean} &lt;code>true&lt;/code> if we have errors, &lt;code>false&lt;/code> otherwise.
   */
  hasErrors() {
    return Boolean(this[_privateKey]._errors.length);
  }

  /**
   * Used to detect instance of schema object internally.
   * @private
   */
  _isBaseObject() {
    return true;
  }
}
</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Apr 18 2016 10:00:02 GMT-0300 (ADT)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
