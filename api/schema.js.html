<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Lounge</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" type="text/css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/cayman.css">
    <link rel="stylesheet" href="css/prism.css">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Lounge</h1>
      <h2 class="project-tagline">Simple Mongoose-inspired ODM for Couchbase</h2><a href="https://github.com/bojand/lounge" target="_blank" class="btn">View on GitHub</a><a href="https://npmjs.com/package/lounge" target="_blank" class="btn">View on npm</a>
    </section>
    <section data-spy="scroll" data-target=".scrollspy" class="main-content">
      <div class="row">
        <div class="col-md-3 col-xs-3 bs-docs-sidebar">
          <ul id="sidebar" class="nav nav-stacked fixed">
            <li><a href="index.html">Main</a></li>
            <li><a href="couchdoc.js.html">couchdoc.js</a></li>
            <li><a href="document.js.html">document.js</a></li>
            <li><a href="driver.js.html">driver.js</a></li>
            <li><a href="index.js.html">index.js</a></li>
            <li><a href="model.js.html">model.js</a></li>
            <li class="active"><a href="schema.js.html">schema.js
                <ul class="nav nav-stacked">
                  <li><a href="#Schema"><i class="alert alert-success"></i><span>Schema</span></a>
                  </li>
                  <li><a href="#add"><i class="alert alert-info"></i><span>add</span></a>
                  </li>
                  <li><a href="#static"><i class="alert alert-info"></i><span>static</span></a>
                  </li>
                  <li><a href="#method"><i class="alert alert-info"></i><span>method</span></a>
                  </li>
                  <li><a href="#virtual"><i class="alert alert-info"></i><span>virtual</span></a>
                  </li>
                  <li><a href="#pre"><i class="alert alert-info"></i><span>pre</span></a>
                  </li>
                  <li><a href="#post"><i class="alert alert-info"></i><span>post</span></a>
                  </li>
                  <li><a href="#set"><i class="alert alert-info"></i><span>set</span></a>
                  </li>
                  <li><a href="#get"><i class="alert alert-info"></i><span>get</span></a>
                  </li>
                  <li><a href="#getDocumentKeyValue"><i class="alert alert-info"></i><span>getDocumentKeyValue</span></a>
                  </li>
                  <li><a href="#getRefKey"><i class="alert alert-info"></i><span>getRefKey</span></a>
                  </li>
                  <li><a href="#hasRefPath"><i class="alert alert-info"></i><span>hasRefPath</span></a>
                  </li>
                  <li><a href="#extend"><i class="alert alert-info"></i><span>extend</span></a>
                  </li>
                </ul></a></li>
            <li><a href="tree.js.html">tree.js</a></li>
            <li><a href="type.js.html">type.js</a></li>
            <li><a href="utils.js.html">utils.js</a></li>
          </ul>
        </div>
        <div class="col-md-9">
          <section id="Schema">
            <h1>Schema</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-success radius ctx-type">constructor</div><span>&nbsp;</span><span>Schema()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>descriptor</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>options</td>
                <td>Object</td>
                <td><pre><code>    - keyPrefix - key prefix for all keys. No default. Generally useful if you wish to namespace documents.
                Example: `app::env::`.
    - keySuffix - Similar as prefix but used as a suffix
    - refIndexKeyPrefix - reference lookup index document key prefix. The name of the index is appended.
                        default: &#39;$_ref_by_&#39;
    - delimiter - delimiter string used for concatenation in reference document key expansion / generation.
                default: &#39;_&#39;. This is prepended to the reference document key.
     - minimize - &quot;minimize&quot; schemas by removing empty objects. Default: true
     - toObject - toObject method options, transform, virtuals and minimize
     - toJSON - toJSON method options, similar to above
     - strict - ensures that value passed in ot assigned that were not specified in our schema do not get saved
</code></pre></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Creates an object schema</p></div>
          <pre><code class="language-javascript">function Schema(descriptor, options) {

  this.callQueue = [];
  this.virtuals = {};
  this.refs = {};
  this.indexes = {};

  var schemaDefaults = {
    strict: true
  };

  // attach options
  this.options = _.defaults(utils.isPlainObject(options) ? options : {},
    schemaDefaults,
    _.pick(utils.defaultOptions, utils.schemaConfigOptionKeys));

  // document key settings
  this.key = {
    docKeyKey: '',
    prefix: null,
    suffix: null,
    generate: true
  };

  // we must use plain objects
  if (typeof descriptor !== 'undefined' &amp;&amp; !utils.isPlainObject(descriptor))
    throw new TypeError('Schema only expects an object as a descriptor. Got \'' + typeof descriptor + '\'');

  // create tree instance with an empty object
  this.tree = new Tree({});

  // add descriptor to tree
  this.add(descriptor);

  // apply these if needed
  if (!this.key.prefix &amp;&amp; utils.isString(this.options.keyPrefix)) {
    this.key.prefix = this.options.keyPrefix;
  }

  if (!this.key.suffix &amp;&amp; utils.isString(this.options.keySuffix)) {
    this.key.suffix = this.options.keySuffix;
  }
}</code></pre>
          <section id="add">
            <h1>add</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>Schema.prototype.add()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>key</td>
                <td>String</td>
                <td><ul>
<li>the key for new property</li>
</ul>
</td>
              </tr>
              <tr>
                <td>descriptor</td>
                <td>Object</td>
                <td><ul>
<li>the property / type descriptor</li>
</ul>
</td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Adds an object to the schema definition</p></div>
          <pre><code class="language-javascript">Schema.prototype.add = function (key, descriptor) {
  // ORDER MATTERS

  // adjust our descriptor
  var d;
  if (key &amp;&amp; descriptor) {
    if (!this.descriptor) {
      this.descriptor = {};
    }
    d = utils.cloneDeep(descriptor);
    this.descriptor[key] = d;
  }
  else if (typeof key === 'object' &amp;&amp; !descriptor) {
    if (!this.descriptor) {
      this.descriptor = utils.cloneDeep(key);
      d = this.descriptor;
    }
    else {
      d = utils.cloneDeep(key);
      var prop;
      for (prop in d) {
        if (d.hasOwnProperty(prop) &amp;&amp; d[prop]) {
          this.descriptor[prop] = d[prop];
        }
      }
    }
  }

  // before add
  this.$_getRefs(d);
  this.$_getIndexes(d);

  this.tree.add.apply(this.tree, arguments);

  // after add
  this.$_applyDocumentKey(d);
};</code></pre>
          <section id="static">
            <h1>static</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>Schema.prototype.static()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>name</td>
                <td>String</td>
                <td></td>
              </tr>
              <tr>
                <td>func</td>
                <td>Function</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Creates a static function for the created model</p></div>
          <pre><code class="language-javascript">Schema.prototype.static = function (name, func) {
  if (utils.isPlainObject(name)) {
    for (func in name) {
      this.static(func, name[func]);
    }
  }
  else {
    if (!utils.isString(name)) throw new TypeError('Schema#static expects a string identifier as a function name');
    else if (!utils.isFunction(func)) throw new TypeError('Schema#static expects a function as a handle');
    this.add(name, {type: Function, static: true, value: func});
  }
};</code></pre>
          <section id="method">
            <h1>method</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>Schema.prototype.method()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>name</td>
                <td>String</td>
                <td></td>
              </tr>
              <tr>
                <td>func</td>
                <td>Function</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Creates a instance method for the created model</p></div>
          <pre><code class="language-javascript">Schema.prototype.method = function (name, func) {
  if (utils.isPlainObject(name)) {
    for (func in name) {
      this.method(func, name[func]);
    }
  }
  else {
    if (!utils.isString(name)) throw new TypeError('Schema#method expects a string identifier as a function name');
    else if (!utils.isFunction(func)) throw new TypeError('Schema#method expects a function as a handle');
    this.add(name, {type: Function, method: true, value: func});
  }
};</code></pre>
          <section id="virtual">
            <h1>virtual</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>Schema.prototype.virtual()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>name</td>
                <td>String</td>
                <td></td>
              </tr>
              <tr>
                <td>options</td>
                <td>Object</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Creates a virtual property for the created model with the given object<br />specifying the get and optionally set function</p></div>
          <pre><code class="language-javascript">Schema.prototype.virtual = function (name, options) {
  if (!utils.isString(name)) throw new TypeError('Schema#virtual expects a string identifier as a property name');
  else if (!utils.isPlainObject(options)) throw new TypeError('Schema#virtual expects an object as a handle');
  else if (!utils.isFunction(options.get)) throw new TypeError('Schema#virtual expects an object with a get function');

  var virtualTypeObj = {type: Object, virtual: true, value: options};
  this.virtuals[name] = virtualTypeObj;
  this.add(name, virtualTypeObj);
};</code></pre>
          <section id="pre">
            <h1>pre</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>Schema.prototype.pre()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Defines a pre hook for the schema.</p></div>
          <pre><code class="language-javascript">Schema.prototype.pre = function () {
  return this.queue('pre', arguments);
};</code></pre>
          <section id="post">
            <h1>post</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>Schema.prototype.post()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Defines a post hook for the schema.</p></div>
          <pre><code class="language-javascript">Schema.prototype.post = function (method, fn) {
  return this.queue('post', arguments);
};</code></pre>
          <section id="set">
            <h1>set</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>Schema.prototype.set()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>key</td>
                <td>String</td>
                <td><p>option name</p></td>
              </tr>
              <tr>
                <td>[value]</td>
                <td>Object</td>
                <td><p>if not passed, the current option value is returned</p></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Sets/gets a schema option.</p></div>
          <pre><code class="language-javascript">Schema.prototype.set = function (key, value) {
  if (1 === arguments.length) {
    return this.options[key];
  }

  this.options[key] = value;

  return this;
};</code></pre>
          <section id="get">
            <h1>get</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>Schema.prototype.get()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>key</td>
                <td>String</td>
                <td><p>option name</p></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Gets a schema option.</p></div>
          <pre><code class="language-javascript">Schema.prototype.get = function (key) {
  return this.options[key];
};</code></pre>
          <section id="getDocumentKeyValue">
            <h1>getDocumentKeyValue</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>Schema.prototype.getDocumentKeyValue()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>id</td>
                <td></td>
                <td><p>the id</p></td>
              </tr>
              <tr>
                <td>full</td>
                <td></td>
                <td><p>if true the full expanded value of the key will be returned if             there were any suffix and / or prefix applied in schema definition<br />            We test if the passed in id already satisfies expansion.</p></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Helper function to get the document key</p></div>
          <pre><code class="language-javascript">Schema.prototype.getDocumentKeyValue = function (id, full) {
  var prefix = utils.isString(this.key.prefix) ? this.key.prefix : '';
  var suffix = utils.isString(this.key.suffix) ? this.key.suffix : '';

  var re = new RegExp('^' + prefix + '.*' + suffix + '$');
  var test = re.test(id);

  if (full) {
    if (test) {
      return id;
    }

    return prefix.concat(id, suffix);
  }

  if (test) {
    id = id.replace(new RegExp('^' + prefix), '');
    id = id.replace(new RegExp(suffix + '$'), '');
  }

  return id;
};</code></pre>
          <section id="getRefKey">
            <h1>getRefKey</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>Schema.prototype.getRefKey()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>name</td>
                <td></td>
                <td><ul>
<li>index name</li>
</ul>
</td>
              </tr>
              <tr>
                <td>v</td>
                <td></td>
                <td><ul>
<li>index value</li>
</ul>
</td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Gets the reference document key value</p></div>
          <pre><code class="language-javascript">Schema.prototype.getRefKey = function (name, v) {
  var d = this.options.delimiter;
  var kp = this.options.keyPrefix || '';
  return kp.concat(this.options.refIndexKeyPrefix || '', name, d, v);
};</code></pre>
          <section id="hasRefPath">
            <h1>hasRefPath</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>Schema.prototype.hasRefPath()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>path</td>
                <td>String</td>
                <td><p>path to check</p></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Returns whether this schema has the specified reference path</p></div>
          <pre><code class="language-javascript">Schema.prototype.hasRefPath = function (path) {
  var ret = false;
  if (this.refs &amp;&amp; path) {
    path = path.toLowerCase();
    for (var key in this.refs) {
      if (this.refs.hasOwnProperty(key) &amp;&amp; this.refs[key].path.toLowerCase() === path) {
        ret = true;
        break;
      }
    }
  }

  return ret;
};</code></pre>
          <section id="extend">
            <h1>extend</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>Schema.prototype.extend()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>other</td>
                <td>Schema</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Extends other schema. Copies properties, virtuals and middelware</p></div>
          <pre><code class="language-javascript">Schema.prototype.extend = function (other) {
  if (other) {
    if (other instanceof Schema &amp;&amp; other.descriptor) {
      var p;
      for (p in other.descriptor) {
        if (other.descriptor.hasOwnProperty(p) &amp;&amp; !this.descriptor[p]) {
          this.add(p, utils.cloneDeep(other.descriptor[p]));
        }
      }
    }

    var self = this;
    other.callQueue.forEach(function (e) {
      self.callQueue.unshift(e);
    });
  }

  return this;
};

module.exports = Schema;</code></pre>
          <div class="footer site-footer">
            <div class="span site-footer-owner"><a href="https://github.com/mr-doc/mr-doc-theme-cayman">Cayman</a> is maintained by <a href="https://github.com/iwatakeshi">iwatakeshi</a>.</div>
            <div class="span site-footer-credits">This page was generated by <a href="https://github.com/mr-doc/mr-doc">Mr. Doc</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</div>
          </div>
        </div>
      </div>
    </section>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/affix.js"></script>
    <script src="js/dropdown.js"></script>
    <script src="js/scrollspy.js"></script>
    <script src="js/prism.js"></script>
    <script src="js/prism-bash.js"></script>
    <script>
      $(document).ready(function(){
        $('body').scrollspy({
          target: ".bs-docs-sidebar",
          offset: 40
        });
        $('#sidebar').affix({
          offset:{
            bottom:60,
            top: 60
          }
        }) 
      });
    </script>
  </body>
</html>